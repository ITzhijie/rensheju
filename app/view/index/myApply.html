{% extends "./layout.html" %}

{% block title %} 咸宁市报考平台-我的报名 {% endblock %}

{% block main %}
<style>
	.baokaoBox {
		background: rgba(255, 255, 255, 0.8);
		padding: 20px;
    }
    .topBox{
		background: rgba(255, 255, 255, 0.8);
        border-bottom: 2px solid rgb(180, 206, 255);
        padding: 10px;
    }

	.mb10{
		margin-bottom: 15px;
    }
    .leftBox{
        float: left;
        width: 20%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 30px 0;
    }
    .leftBox a{
        display: block;
        width: 80px;
        margin-bottom: 20px;
    }
    .rightBox{
        overflow: hidden;
        min-height: 200px;
        border-left: 1px solid  rgb(180, 206, 255);
        padding: 20px;
    }
    .tabBox{
        padding: 10px 0;
    }
    .tabBox li{
        display: inline-block;
        padding: 0 20px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        border: 1px solid rgb(131, 131, 131);
        color:  rgb(131, 131, 131);
        border-radius: 2px;
        cursor: pointer;
    }
    .tabBox .current{
        border: none;
        background: rgb(255, 118, 38);
        color: #fff;
    }
    .handlebtn{
        cursor: pointer;
        color: rgb(67, 67, 255);
    }
    .table{
        display: none;
    }
    
    .table0{
        display: table;
    }
</style>
<div class="topBox">
    <span>你好，{{userInfo.uname}}</span>
    <a class="pull-right" href="/home/loginout">退出</a>

</div>
<div class="baokaoBox">
    
    <div class="leftBox">
        <a class="btn btn-default" href="/home/index">考试报名</a>
        <a class="btn btn-info" href="/home/myApply">我的报名</a>
        <a class="btn btn-default" href="/home/myInfo">我的资料</a>

    </div>
    <div class="rightBox">
        <ul class="tabBox">
            <li class="current">已申请</li>
            <li>待缴费</li>
            <li>待考试</li>
            <li>成绩查询</li>
        </ul>
        <!-- 已申请 -->
        <table class="table table-bordered table0">
            <thead>
                <tr>
                    <th>报考类型</th>
                    <th>报考专业</th>
                    <th>报名时间</th>
                    <th>当前状态</th>
                    <th>审核时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for list in lists %}
                {% if list.verify_status != 1 %}

                <tr>
                    <td>{{list.exam[0].exam_name}}</td>
                    <td>{{list.classify[0].classify_name}}</td>
                    <td>{{helper.formatTime(list.apply_time)}}</td>
                    <td>
                        {% if list.verify_status ==0 %}
                        <span class="label label-warning">待审核</span>
                        {% else %}
                        <span class="label label-danger">审核不通过</span>
                        {% endif %}
                    </td>
                    <td>{{helper.formatTime(list.verify_time)}}</td>
                    <td>
                        {% if list.verify_status ==2 %}
                        <span class="handlebtn reason" data-reason="{{list.verify_reason}}">查看原因</span>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}

                {% endfor %}

            </tbody>
        </table>
        <!-- 待缴费 -->
        <table class="table table-bordered table1">
            <thead>
                <tr>
                    <th>报考类型</th>
                    <th>报考专业</th>
                    <th>考试时间</th>
                    <th>当前状态</th>
                    <th>缴费截止时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for list in lists %}
                {% if list.verify_status ==1 and list.pay_status==0 %}

                <tr>
                    <td>{{list.exam[0].exam_name}}</td>
                    <td>{{list.classify[0].classify_name}}</td>
                    <td>{{helper.formatTime2(list.classify[0].exam_start)}}</td>
                    <td><span class="label label-success">审核通过待缴费</span></td>
                    <td>{{helper.formatTime2(list.classify[0].pay_end)}}</td>
                    <td>
                        <span class="handlebtn payBtn" data-id="{{list._id}}">缴费</span>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}

            </tbody>
        </table>
        <!-- 待考试 -->
        <table class="table table-bordered table2">
            <thead>
                <tr>
                    <th>报考类型</th>
                    <th>报考专业</th>
                    <th>当前状态</th>

                    <th>考试时间</th>

                    <th>准考证号</th>
                    <th>考试地点</th>

                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for list in lists %}
                {% if list.verify_status ==1 and list.pay_status==1 and (nowDate < list.classify[0].exam_end) %}

                <tr>
                    <td>{{list.exam[0].exam_name}}</td>
                    <td>{{list.classify[0].classify_name}}</td>
                    <td><span class="label label-warning">待考试</span></td>
                    <td>{{helper.formatTime2(list.classify[0].exam_start)}}</td>
                    <td>{{list.exam_card}}</td>
                    <td>{{list.room_name}}</td>

                    <td>
                        {% if  (nowDate > list.downcard_date) %}

                        <span class="handlebtn downCard" data-id="{{list._id}}">下载准考证</span>
                        {% endif %}
                    
                    </td>
                </tr>
                {% endif %}
                {% endfor %}

            </tbody>
        </table>
        <!-- 成绩查询 -->
        <table class="table table-bordered table3">
            <thead>
                <tr>
                    <th>报考类型</th>
                    <th>报考专业</th>
                    <th>考试时间</th>
                    <th>考试结果</th>
                </tr>
            </thead>
            <tbody>
                {% for list in lists %}
                {% if list.verify_status ==1 and list.pay_status==1 and (nowDate > list.classify[0].exam_end) %}

                <tr>
                    <td>{{list.exam[0].exam_name}}</td>
                    <td>{{list.classify[0].classify_name}}</td>
                    <td>{{helper.formatTime2(list.exam[0].exam_start)}}</td>
                    <td>
                        {% if  list.result_status==1 %}

                        <span class="handlebtn getResult" data-id="{{list._id}}">查看</span>
                        {% else %}
                        <span class="label label-warning">待公布</span>

                        {% endif %}
                    
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
                
            </tbody>
        </table>
    </div>
</div>
<script>

    $(".tabBox li").click(function(){
        var index=$(this).index();
        console.log(index);
        $(this).addClass("current").siblings("li").removeClass("current");
        $(".table").hide();

        $(".table"+index).show();
        if ($(".table"+index+" tbody").find("tr").length==0) {
            $(".table"+index+" tbody").html('<tr><td class="text-center" colspan="4">暂无对应报考信息</td></tr>');
        }
    })
  
    $(".reason").click(function(){
        var _this=$(this);
        Swal.fire({
            title: "不通过原因",
            text: _this.attr("data-reason"),
            icon: 'info',
            showCancelButton: false,
            allowOutsideClick:false,
            confirmButtonColor: '#3085d6',
            confirmButtonText: '确定',
        })
    })
</script>

{% endblock %}